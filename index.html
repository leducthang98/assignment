<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Liquidity Pool Simulation</title>
  <script>
    async function getPools() {
      try {
        const response = await fetch('http://localhost:3000/api/liquidity/pools');
        const pools = await response.json();
        const poolSelect = document.getElementById('poolSelect');
        pools.forEach(pool => {
          const option = document.createElement('option');
          option.value = pool.lpTokenPrice;
          option.textContent = pool.name;
          poolSelect.appendChild(option);
        });
      } catch (error) {
        console.error('Error fetching pools:', error);
      }
    }

    async function submitInvestment() {
      const email = document.getElementById('email').value;
      const pool = document.getElementById('poolSelect').value;
      const investmentAmount = 100000; // $100,000 USD

      localStorage.setItem('email', email);

      try {
        const response = await fetch('http://localhost:3000/api/portfolio', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ 
            email,

            }),
        });

        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        const portfolioValue = await response.json();
      } catch (error) {
        console.error('Error submitting investment:', error);
      }
    }

    async function getPortfolio() {
      const email = document.getElementById('email').value;

      try {
        const response = await fetch(`http://localhost:3000/api/portfolio/${email}`);
        const portfolioValue = await response.json();
        document.getElementById('result').textContent = `Your portfolio value is $${portfolioValue}`;
      } catch (error) {
        console.error('Error fetching portfolio:', error);
      }
    }

    function loadEmail() {
      const email = localStorage.getItem('email');
      if (email) {
        document.getElementById('email').value = email;
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      getPools();
      loadEmail();
    });
  </script>
</head>
<body>
  <h1>Liquidity Pool Simulation</h1>
  <form id="investmentForm" onsubmit="event.preventDefault(); submitInvestment();">
    <label for="email">Email:</label>
    <input type="email" id="email" required>
    <br>
    <label for="poolSelect">Select Pool:</label>
    <select id="poolSelect" required>
      <option value="">--Select a Pool--</option>
    </select>
    <br>
    <button type="submit">Invest $100,000</button>
  </form>
  <br>
  <button onclick="getPortfolio()">Get Portfolio Value</button>
  <br>
  <p id="result"></p>
</body>
</html>
